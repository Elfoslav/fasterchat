<template name="chat">
  <div class="row" id="chat">
    <div class="col-sm-12">
      <h3 class="row">
        <span class="col-xs-2">
          <img src="https://graph.facebook.com/{{friend.services.facebook.id}}/picture?type=small" alt="photo" />
        </span>

        <span class="col-xs-10">
          <small>Chat with </small>
          {{friend.profile.name}}

          {{#if isOnline friend.services.facebook.id}}
            <span class="dot dot-online" title="online"></span>
          {{else}}
            <span class="dot dot-offline" title="offline"></span>
          {{/if}}

          {{#if isOnline friend.services.facebook.id}}{{#if friend.inChat}}<small>(in chat)</small>{{/if}} {{/if}}
        </span>
      </h3>

      {{#each messages}}
        <p class="row">
          <span class="col-xs-2"><img src="https://graph.facebook.com/{{senderFbId}}/picture?type=small" alt="photo" /></span>
          <span class="col-xs-10"><small>{{timestamp.toLocaleDateString}} {{timestamp.toLocaleTimeString}}</small>: {{message}} {{#unless isRead}}<small>(unread)</small>{{/unless}}</span>
        </p>
      {{/each}}
      <p class="hidden typing-now">
        <img src="https://graph.facebook.com/{{friend.services.facebook.id}}/picture?type=small" alt="photo" />
        <small>Typing now:</small> <span class="typing-now-text"></span>
      </p>
      <p>
        <textarea class="form-control chat-textarea" rows="3" placeholder="Write to {{friend.profile.name}}"></textarea>
      </p>
    </div>
  </div>
</template>